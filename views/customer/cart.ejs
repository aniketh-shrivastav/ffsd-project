<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <link rel="stylesheet" href="/styles/styles.css">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background-color: #007bff;
    color: white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.home-button {
    text-decoration: none;
    background-color: white;
    color: #007bff;
    padding: 8px 15px;
    font-weight: bold;
    border-radius: 5px;
    border: 2px solid #007bff;
    transition: all 0.3s ease;
}

.home-button:hover {
    background-color: #007bff;
    color: white;
    border: 2px solid white;
}

        .cart-container, .payment-container, .checkout-container {
            width: 60%;
            margin: auto;
            background: white;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
            margin-top: 20px;
        }
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        .cart-item:hover {
            background: #f0f0f0;
        }
        .cart-item img {
            width: 80px;
            height: auto;
            border-radius: 8px;
        }
        .checkout-options button {
            padding: 10px 15px;
            margin: 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
        }
        #place-order {
            background: #28a745;
            color: white;
        }
        #book-service {
            background: #007bff;
            color: white;
        }
        .checkout-options button:hover {
            opacity: 0.8;
        }
        #confirm-payment {
            background: #ff9800;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        .payment-method {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .payment-method label {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }
        .payment-method input {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="public/images3/logo2.jpg" alt="AutoCustomizer Logo"> <!-- Replace with actual logo -->
        </div>

        

        <%- include("../partials/customerHeaders") %>

    
    </header>
    

    <main>
        <h2>Your Cart Items</h2>
        <div class="cart-container" id="cart-container"></div>

        <div class="payment-container" id="total-section" style="display: none;">
            <p><strong>Total Price:</strong> ₹<span id="total-price">0</span></p>
            <button class="checkout" id="checkout-btn">Proceed to Checkout</button>
        </div>

        <div class="payment-container" id="payment-selection" style="display: none;">
            <h2>Select Payment Method</h2>
            <div id="saved-payments" class="payment-method"></div>
            <label><input type="radio" name="payment-method" value="cod"> Cash on Delivery</label>
            <br>
            <button id="confirm-payment">Confirm Payment Method</button>
        </div>

        <div class="checkout-container" id="checkout-section" style="display: none;">
            <h2>Choose an Option</h2>
            <div class="checkout-options">
                <button id="place-order">Place Order</button>
                <button id="book-service">Book a Service Provider</button>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            loadCart();
        });

        function loadCart() {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let cartContainer = document.getElementById("cart-container");
    let totalPrice = 0;

    cartContainer.innerHTML = "";
    if (cart.length === 0) {
        cartContainer.innerHTML = '<p class="empty-cart">Your cart is empty.</p>';
        document.getElementById("total-section").style.display = "none";
        return;
    }

    document.getElementById("total-section").style.display = "block";

    cart.forEach((item, index) => {
        let cartItem = document.createElement("div");
        cartItem.classList.add("cart-item");
        cartItem.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
           <p>${item.name} - ₹${item.price}</p>

            <div>
                <button class="quantity-btn" data-index="${index}" data-action="decrease">−</button>
                <span class="quantity" id="qty-${index}">${item.quantity}</span>
                <button class="quantity-btn" data-index="${index}" data-action="increase">+</button>
            </div>
            <button class="remove" data-index="${index}">Remove</button>
        `;
        cartContainer.appendChild(cartItem);
        totalPrice += item.price * item.quantity;
    });

    document.getElementById("total-price").textContent = totalPrice.toFixed(2);

    // Quantity button handlers
    document.querySelectorAll(".quantity-btn").forEach(button => {
        button.addEventListener("click", function () {
            let index = parseInt(this.getAttribute("data-index"));
            let action = this.getAttribute("data-action");

            if (action === "increase") {
                cart[index].quantity += 1;
            } else if (action === "decrease" && cart[index].quantity > 1) {
                cart[index].quantity -= 1;
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            loadCart();
        });
    });

    // Remove button handlers
    document.querySelectorAll(".remove").forEach(button => {
        button.addEventListener("click", function () {
            let index = this.getAttribute("data-index");
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            loadCart();
        });
    });
}

        document.getElementById("checkout-btn").addEventListener("click", function () {
            document.getElementById("payment-selection").style.display = "block";
            loadPaymentMethods();
        });

        function loadPaymentMethods() {
            let savedPayments = JSON.parse(localStorage.getItem("paymentMethods")) || [];
            let paymentDiv = document.getElementById("saved-payments");
            paymentDiv.innerHTML = "";
            
            savedPayments.forEach((payment, index) => {
                paymentDiv.innerHTML += `<label><input type='radio' name='payment-method' value='${index}'> ${payment}</label>`;
            });
        }

        document.getElementById("confirm-payment").addEventListener("click", function () {
            let selectedMethod = document.querySelector("input[name='payment-method']:checked");
            if (!selectedMethod) {
                alert("Please select a payment method.");
                return;
            }
            
            let paymentText = selectedMethod.value === "cod" ? "Cash on Delivery" : 
                JSON.parse(localStorage.getItem("paymentMethods"))[selectedMethod.value];

            localStorage.setItem("selectedPaymentMethod", paymentText);
            document.getElementById("checkout-section").style.display = "block";
        });

        document.getElementById("book-service").addEventListener("click", function () {
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart.length === 0) {
                alert("Your cart is empty. Add items before booking a service.");
                return;
            }

            let selectedPaymentMethod = localStorage.getItem("selectedPaymentMethod") || "Not Selected";
            localStorage.setItem("cartBackup", JSON.stringify(cart));
            localStorage.setItem("paymentBackup", selectedPaymentMethod);
            window.location.href = "service.html";
        });
        document.getElementById("place-order").addEventListener("click", function () {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    if (cart.length === 0) {
        alert("Your cart is empty. Add items before placing an order.");
        return;
    }

    let selectedPaymentMethod = localStorage.getItem("selectedPaymentMethod") || "Not Selected";
    
    let deliveryDate = new Date();
    deliveryDate.setDate(deliveryDate.getDate() + Math.floor(Math.random() * 3) + 5); // Arrives in 5-7 days
    
    let upcomingOrders = JSON.parse(localStorage.getItem("upcomingOrders")) || [];
    upcomingOrders.push({ cart, paymentMethod: selectedPaymentMethod, arrival: deliveryDate.toDateString() });
    
    localStorage.setItem("upcomingOrders", JSON.stringify(upcomingOrders));
    
    alert("Order placed successfully! Estimated arrival: " + deliveryDate.toDateString());
    
    localStorage.removeItem("cart"); // Clear cart after placing order
    window.location.href = "history.html";
});

    </script>
</body>
</html>
