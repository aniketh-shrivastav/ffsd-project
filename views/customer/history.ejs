<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order & Booking History</title>
    <link rel="stylesheet" href="/styles/styles.css">
</head>
<body>
    <header>
        <div class="logo">
            <img src="public/images3/logo2.jpg" alt="AutoCustomizer Logo"> <!-- Replace with actual logo -->
        </div>
  <%- include("../partials/customerHeaders") %>
    </header>

    <main>
        <h2>Upcoming Orders</h2>
        <ul id="upcoming-orders" class="parts-list"></ul>

        <h2>Past Orders</h2>
        <ul id="past-orders" class="parts-list"></ul>

        <h2>Upcoming Services</h2>
        <ul id="upcoming-services" class="parts-list"></ul>

        <h2>Past Services</h2>
        <ul id="past-services" class="parts-list"></ul>
    </main>

    <footer>
        <div class="footer-container">
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Email: support@autocustomizer.com</p>
                <p>Phone: +123-456-7890</p>
                <p>Address: 123 Auto Street, Custom City</p>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#"><img src="/images/facebook-icon.png" alt="Facebook"></a>
                    <a href="#"><img src="/images/twitter-icon.png" alt="Twitter"></a>
                    <a href="#"><img src="/images/instagram-icon.png" alt="Instagram"></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 AutoCustomizer. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        function toggleMenu() {
            document.getElementById("mobileMenu").classList.toggle("show");
        }

        document.addEventListener("DOMContentLoaded", function () {
            displayOrders();
            displayServices();

            // Search functionality
            const searchInput = document.getElementById("search-input");
            const searchBtn = document.getElementById("search-btn");

            function filterItems() {
                const searchValue = searchInput.value.toLowerCase();
                const allItems = document.querySelectorAll(".history-item");

                allItems.forEach(item => {
                    const itemText = item.textContent.toLowerCase();
                    if (itemText.includes(searchValue)) {
                        item.style.display = "flex";
                    } else {
                        item.style.display = "none";
                    }
                });
            }

            searchInput.addEventListener("input", filterItems);
            searchBtn.addEventListener("click", filterItems);
        });

        function displayOrders() {
    let upcomingOrders = JSON.parse(localStorage.getItem("upcomingOrders")) || [];
    let pastOrders = JSON.parse(localStorage.getItem("pastOrders")) || [];

    const upcomingOrdersHtml = upcomingOrders.map(order => {
        // Get item names from the cart
        const itemNames = order.cart.map(item => item.name).join(", ");
        
        return `<li class="history-item part">
            <div class="item-details">
                <h3>${itemNames || "Order"}</h3>
                <p>Expected Delivery: ${order.arrival || "Processing"}</p>
                <p>Payment Method: ${order.paymentMethod}</p>
            </div>
        </li>`;
    }).join("");
    
    const pastOrdersHtml = pastOrders.map(o => 
        `<li class="history-item part">
            <div class="item-details">
                <h3>${o.item}</h3>
                <p>Status: Delivered</p>
            </div>
            <button onclick="review('${o.item}')" class="review-btn">Review</button>
        </li>`
    ).join("");

    document.getElementById("upcoming-orders").innerHTML = upcomingOrdersHtml || "<p class='no-items'>No upcoming orders</p>";
    document.getElementById("past-orders").innerHTML = pastOrdersHtml || "<p class='no-items'>No past orders</p>";
}

        function displayServices() {
            let upcomingServices = JSON.parse(localStorage.getItem("upcomingServices")) || [];
            let pastServices = JSON.parse(localStorage.getItem("pastServices")) || [];

            const upcomingServicesHtml = upcomingServices.map((s, index) => 
                `<li class="history-item part">
                    <div class="item-details">
                        <h3>${s.service}</h3>
                        <p>Scheduled on: ${s.date}</p>
                    </div>
                    <button onclick="completeService(${index})" class="complete-btn">Mark as Completed</button>
                </li>`
            ).join("");
            
            const pastServicesHtml = pastServices.map(s => 
                `<li class="history-item part">
                    <div class="item-details">
                        <h3>${s.service}</h3>
                        <p>Status: Completed</p>
                    </div>
                    <button onclick="reviewService('${s.service}')" class="rate-btn">Rate</button>
                </li>`
            ).join("");

            document.getElementById("upcoming-services").innerHTML = upcomingServicesHtml || "<p class='no-items'>No upcoming services</p>";
            document.getElementById("past-services").innerHTML = pastServicesHtml || "<p class='no-items'>No past services</p>";
        }

        function completeService(index) {
            let upcomingServices = JSON.parse(localStorage.getItem("upcomingServices")) || [];
            let pastServices = JSON.parse(localStorage.getItem("pastServices")) || [];

            let completedService = upcomingServices.splice(index, 1)[0];
            pastServices.push(completedService);

            localStorage.setItem("upcomingServices", JSON.stringify(upcomingServices));
            localStorage.setItem("pastServices", JSON.stringify(pastServices));
            displayServices();
        }

        function review(item) {
            let reviewText = prompt(`Leave a review for ${item}:`);
            if (reviewText) alert("Review submitted!");
        }

        function reviewService(service) {
            let rating = prompt(`Rate ${service} (1-5 stars):`);
            if (rating && rating >= 1 && rating <= 5) {
                alert(`You rated ${service} ${rating} stars!`);
            } else {
                alert("Invalid rating. Please enter a number between 1 and 5.");
            }
        }
    </script>

    <style>
        /* Additional styles specific to history page */
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-details h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-dark);
        }
        
        .item-details p {
            color: #666;
            font-size: 14px;
        }
        
        .review-btn, .rate-btn, .complete-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .rate-btn {
            background: var(--warning-color);
        }
        
        .complete-btn {
            background: var(--success-color);
        }
        
        .review-btn:hover, .rate-btn:hover, .complete-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .no-items {
            text-align: center;
            color: #888;
            padding: 20px;
            font-style: italic;
        }
        
        /* Responsive */
        @media screen and (max-width: 768px) {
            .history-item {
                flex-direction: column;
                text-align: center;
            }
            
            .item-details {
                margin-bottom: 15px;
            }
        }
    </style>
</body>
</html>